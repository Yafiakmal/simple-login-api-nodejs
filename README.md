# simple-login-api-nodejs

---

## Run in docker

### Requirement

1. docker installed
2. clone this repo 
3. create ./app/.env file then enter the variable bellow
  > you must create and get the **_app passwords_** in [google account](https://myaccount.google.com/apppasswords)

```
EMAIL_USER = <your gmail>
EMAIL_PASS = <password app from google account>

```

4. Run docker compose

[this](./docker-compose.yml) compose would install and run 2 images. **nodejs:lts** and **postgres:latest**

```shell
docker compose -f docker-compose.yml up -d
docker ps
```

5. Run this to generate table needed
> **run this** only for first time
- linux
```shell
cat database_dump.sql | docker exec -i node-login-db psql -U postgres node-login-db
```
- windows
```powershell
Get-Content database_dump.sql | docker exec -i node-login-db psql -U postgres node-login-db
```

---

## You are ready to test the API

### POST http://localhost:3000/auth/register

```bash
 curl -X POST http://localhost:3000/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "yourname",
    "email":"youremail@gmail.com",
    "password":"yourpassword"
}'
```

successful response

```json
{
    "status":"success",
    "data": [{
        "verify_code":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InlvdXJlbWFpbEBnbWFpbC5jb20iLCJpYXQiOjE3NDk1NDU5NjcsImV4cCI6MTc0OTcyNTk2N30.0-_xAFIsTOsw9Bbrq_UYZwuZWFvllJTmyWLgvdKnTu8"
        }],
    "message":"Succesfully registered, Please verify your email youremail@gmail.com to complete registration."
        }%
```

_**verify_code**_ is used to verify your email 

### GET http://localhost:3000/auth/verify/:token

you can get **token** from register. then verify your email

```bash
curl -X GET http://localhost:3000/auth/verify/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InlvdXJlbWFpbEBnbWFpbC5jb20iLCJpYXQiOjE3NDk1NDU5NjcsImV4cCI6MTc0OTcyNTk2N30.0-_xAFIsTOsw9Bbrq_UYZwuZWFvllJTmyWLgvdKnTu8

```

successful response
```json
{
    "status":"success",
    "data":[{
        "email":"youremail@gmail.com"
        }],
    "message":"Your Email, Verified Successfuly."
}%
```

### POST http://localhost:3000/auth/login

this curl command would save cookie in cookie.txt
```bash
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -c "cookie.txt" \
  -d '{
    "identifier": "yourname",
    "password":"yourpassword"
}'
```
successful response
```json
{
    "status":"success",
    "message":"You are login succesfully",
    "data":[{
        "token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZF91c2VyIjoiMDA3MTQ3ZDktNWI1ZC00ZGI4LTg2Y2YtYzdhN2QzYWY2MzlkIiwidXNlcm5hbWUiOiJ5b3VybmFtZSIsImVtYWlsIjoieW91cmVtYWlsQGdtYWlsLmNvbSIsImlhdCI6MTc0OTU0NzQzNywiZXhwIjoxNzQ5NTQ3NzM3fQ.IIsM68Ig7LAEWdk2DBLa6eMUpBO18VsoMlJ7G5x0u2A",
        "rtoken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZF91c2VyIjoiMDA3MTQ3ZDktNWI1ZC00ZGI4LTg2Y2YtYzdhN2QzYWY2MzlkIiwidXNlcm5hbWUiOiJ5b3VybmFtZSIsImVtYWlsIjoieW91cmVtYWlsQGdtYWlsLmNvbSIsImlhdCI6MTc0OTU0NzQzNywiZXhwIjoxNzUwMTUyMjM3fQ.YYIlU-BkTMVNcl1YnfAcxXN-yPXc1deuXzCLXwCX7qs"
        }]
}% 
```

### GET http://localhost:3000/user/
```bash
curl -X GET http://localhost:3000/user/ \
-c "cookie.txt" \
-H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZF91c2VyIjoiMDA3MTQ3ZDktNWI1ZC00ZGI4LTg2Y2YtYzdhN2QzYWY2MzlkIiwidXNlcm5hbWUiOiJ5b3VybmFtZSIsImVtYWlsIjoieW91cmVtYWlsQGdtYWlsLmNvbSIsImlhdCI6MTc0OTU0ODcxOSwiZXhwIjoxNzQ5NTQ5MDE5fQ.3GS-15oBAawfS1jtklbC7M44oOQmGPbEIKNpE-fc5-M"
```
successfull response
```json
{
    "status":"success",
    "message":"successfully get data user",
    "data":[{
        "userData":{
            "username":"yourname",
            "email":"youremail@gmail.com"
            }
        }]
}%
```

### POST http://localhost:3000/auth/logout
logout would revoke refresh token in database

```bash
curl -X POST http://localhost:3000/auth/logout \
-b "cookie.txt" -c cookie.txt
```
`-b` would include cookie.txt in request
`-c` would set new empty cookie


```txt
╭─muhammad at acer in ~
╰─○ cat cookie.txt                                 
# Netscape HTTP Cookie File
# https://curl.haxx.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.

#HttpOnly_localhost	FALSE	/auth/refresh	FALSE	1750154559	refreshTokenRefresh	eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZF91c2VyIjoiMDA3MTQ3ZDktNWI1ZC00ZGI4LTg2Y2YtYzdhN2QzYWY2MzlkIiwidXNlcm5hbWUiOiJ5b3VybmFtZSIsImVtYWlsIjoieW91cmVtYWlsQGdtYWlsLmNvbSIsImlhdCI6MTc0OTU0OTc1OSwiZXhwIjoxNzUwMTU0NTU5fQ.7mKIHQKePlvJPG9plEeS2efkwFFr5QConRzrnjzi63U
#HttpOnly_localhost	FALSE	/auth/logout	FALSE	1750154559	refreshTokenLogout	eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZF91c2VyIjoiMDA3MTQ3ZDktNWI1ZC00ZGI4LTg2Y2YtYzdhN2QzYWY2MzlkIiwidXNlcm5hbWUiOiJ5b3VybmFtZSIsImVtYWlsIjoieW91cmVtYWlsQGdtYWlsLmNvbSIsImlhdCI6MTc0OTU0OTc1OSwiZXhwIjoxNzUwMTU0NTU5fQ.7mKIHQKePlvJPG9plEeS2efkwFFr5QConRzrnjzi63U
╭─muhammad at acer in ~
╰─○ curl -X POST http://localhost:3000/auth/logout \
-b "cookie.txt" -c cookie.txt
╭─muhammad at acer in ~
╰─○ cat cookie.txt                                  
# Netscape HTTP Cookie File
# https://curl.haxx.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.
```

### POST http://localhost:3000/auth/refresh
```bash
curl -X POST http://localhost:3000/auth/refresh -b cookie.txt -c cookie.txt
```

successful response
```json
{
    "status":"success",
    "message":"You are login succesfully",
    "data":[{
        "token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZF91c2VyIjoiMDA3MTQ3ZDktNWI1ZC00ZGI4LTg2Y2YtYzdhN2QzYWY2MzlkIiwidXNlcm5hbWUiOiJ5b3VybmFtZSIsImVtYWlsIjoieW91cmVtYWlsQGdtYWlsLmNvbSIsImlhdCI6MTc0OTU1MDA5NywiZXhwIjoxNzQ5NTUwMzk3fQ.cppRsoLj8KPPfJFkMyeKtJp-wXXfZQ3YFBXV_XqH8-Y"
    }]
}%    
```

### POST http://localhost:3000/auth/remove
```bash
curl -X POST http://localhost:3000/auth/remove \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZF91c2VyIjoiMDA3MTQ3ZDktNWI1ZC00ZGI4LTg2Y2YtYzdhN2QzYWY2MzlkIiwidXNlcm5hbWUiOiJ5b3VybmFtZSIsImVtYWlsIjoieW91cmVtYWlsQGdtYWlsLmNvbSIsImlhdCI6MTc0OTU1MDc1NCwiZXhwIjoxNzQ5NTUxMDU0fQ.DWl_sXy3q3aHUGP_q_XGp6WU9y_iNKnqz0XhDOgSMAs" \
  -H "Content-Type: application/json" \
  -c cookie.txt \
  -d '{"password": "yourpassword"}'

```

successful response
```json
{"status":"success","message":"yourname was successfully deleted","data":[]}
```

